{% extends 'base.html' %}
{% load humanize %}

{% block content %}
    <!-- 블럭 안에 들어갈 내용-->

    <!-- 확인하고자 하는 URL 입력창 & 버튼 -->
    <form method="post" action="{% url 'sugang:testURL' %}">
      {% csrf_token %}
      <div class="input-group mb-3 URL-input">
        <button class="btn btn-outline-secondary" type="submit">테스트</button>  
        <input id="saveURL" name="saveURL" type="text" class="form-control px-3" placeholder="접속하고자 하는 URL을 입력해주세요.">
      </div>
    </form>

    <section class="result-table">

      {% include "components/speedtest_result.html" %}
      {% include "components/servertime.html" %}
    
    </section>

    <section style="display: flex; align-items: center; justify-content: center; height: 260px;">
      <!-- 결과화면 두 곳을 float할 구역-->
      <div class="main-alarmbox">
        <div class="card">
          <div class="card-header text-center">
            알람 설정하기
          </div>
          <div class="card-body" style="height:200px;">
            <form id="alarm-form">
              <div class="form-group">
                  <input type="time" class="form-control" id="alarm-time">
              </div>
              <div class="form-group">
                  <label>알람 울릴시간</label>
                  <div class="form-check">
                      <input type="radio" class="form-check-input" id="set_3min" name="set_alarm">
                      <label class="form-check-label" for="set_3min">3분 전</label>
                  </div>
                  <div class="form-check">
                      <input type="radio" class="form-check-input" id="set_1min" name="set_alarm">
                      <label class="form-check-label" for="set_1min">1분 전</label>
                  </div>
                  <div class="form-check">
                    <input type="radio" class="form-check-input" id="set_30sec" name="set_alarm">
                    <label class="form-check-label" for="set_30sec">30초 전</label>
                </div>
              </div>
              <button type="submit" class="btn btn-primary" style="width:100%; margin:auto;">알람 설정</button>
            </form>          
          </div>
        </div>
      </div>

      <div class="main-rankingbox">
        <div class="card text-center">
          <div class="card-header">
            인터넷 속도 랭킹
          </div>
          <div class="card-body" style="height:200px;">
            <h5 class="card-title">종합성적은...</h5>
            <p class="card-text" style="margin:auto;"> 상위 {{ speed_ranking|default:''}}%입니다.</p>
          </div>
        </div>
      </div>
  
      <div class="main-ratebox">
          <div class="card text-center">
              <div class="card-header">
                  수강신청 성공확률
              </div>
              <div class="card-body" style="height:200px;">
                  <h5 class="card-title">귀하의 수강신청 확률은..</h5>
                  <p class="card-text" style="marign:auto;">{{ apply_rate|default:''}}입니다.</p>
              </div>
          </div>
      </div>
    </section>
  

{% endblock%}

{% block script %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function() {
        setInterval(function() {
            var ajaxURL = '{{ user_url }}';
            if (ajaxURL === '') {
                ajaxURL = 'load_defaultclock/';
            } else {
                ajaxURL = 'loadclock/';
            }
            $.ajax({
                url: ajaxURL,
                success: function(data) {
                    $('#servertime-container').text(data.current_servertime);
                }
            });
        }, 1000);
    });
</script>
{% endblock %}